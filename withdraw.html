<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Çekim Paneli</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { background-color: #0f0f13; color: #e0e0e0; font-family: 'Rajdhani', sans-serif; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        .withdraw-card { background: #1a1a24; border: 1px solid #333; padding: 30px; border-radius: 15px; width: 100%; max-width: 450px; box-shadow: 0 0 30px rgba(0,0,0,0.5); margin-bottom: 30px; }
        h2 { margin: 0 0 20px 0; color: #fff; text-align: center; border-bottom: 1px solid #333; padding-bottom: 15px; }
        .balance-box { display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #444; }
        .balance-val { font-size: 1.4rem; color: #00ff88; font-weight: bold; }
        .input-group { margin-bottom: 15px; position: relative; }
        .input-group label { display: block; margin-bottom: 5px; color: #ccc; font-size: 0.9rem; }
        .input-group input { width: 100%; padding: 12px; background: #0f0f13; border: 1px solid #444; color: white; border-radius: 5px; font-family: 'Rajdhani', sans-serif; font-size: 1.1rem; box-sizing: border-box; }
        .input-group input:focus { border-color: #00ff88; outline: none; }
        .btn-max { position: absolute; right: 10px; top: 32px; background: #333; color: #00ff88; border: none; padding: 5px 10px; cursor: pointer; font-weight: bold; }
        
        .btn-submit { background: #2e7d32; color: #fff; border: none; padding: 15px; font-size: 1.1rem; font-weight: bold; cursor: pointer; border-radius: 5px; width: 100%; margin-top: 10px; transition: 0.3s; }
        .btn-submit:hover { background: #388e3c; }
        
        .history-section { width: 100%; max-width: 700px; }
        .history-header { border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 10px; color: #aaa; }
        table { width: 100%; border-collapse: collapse; background: #1a1a24; border-radius: 10px; overflow: hidden; font-size: 0.9rem; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #333; }
        th { background: #222; color: #aaa; }
        .st-wait { color: #f1c40f; } .st-rej { color: #ff4757; } .st-ok { color: #00ff88; }
        #msg-area { text-align: center; margin-top: 15px; min-height: 20px; font-size: 0.95rem; }
    </style>
</head>
<body>

    <div class="withdraw-card">
        <h2>Çekim Talebi</h2>
        <div class="balance-box">
            <div><div style="font-size:0.9rem; color:#aaa;">Kullanılabilir</div><div class="balance-val"><span id="display-balance">0.0000</span> BTC</div></div>
            <i class="fa-solid fa-wallet" style="font-size: 1.5rem; color: #555;"></i>
        </div>

        <div class="input-group">
            <label>Cüzdan Adresi</label>
            <input type="text" id="wallet-address" placeholder="Adres yapıştır...">
        </div>

        <div class="input-group">
            <label>Tutar</label>
            <input type="number" id="withdraw-amount" placeholder="0.0000">
            <button class="btn-max" onclick="setMaxAmount()">MAX</button>
        </div>

        <button id="submitBtn" class="btn-submit" onclick="submitRequest()">ONAYLA VE ÇEK</button>
        <div id="msg-area"></div>
    </div>

    <div class="history-section">
        <div class="history-header">Son İşlemler</div>
        <table>
            <thead><tr><th>Tarih</th><th>Tutar</th><th>Durum</th><th>Not</th></tr></thead>
            <tbody id="history-body"></tbody>
        </table>
    </div>

    <script>
        window.onload = function() { loadBalance(); loadHistory(); };

        function loadBalance() {
            var stored = localStorage.getItem("userMiningBalance");
            var bal = parseFloat(stored) || 0;
            document.getElementById("display-balance").innerText = bal.toFixed(4);
        }

        function setMaxAmount() {
            var stored = localStorage.getItem("userMiningBalance");
            var bal = parseFloat(stored) || 0;
            document.getElementById("withdraw-amount").value = bal.toFixed(4);
        }

        function submitRequest() {
            var btn = document.getElementById("submitBtn");
            var address = document.getElementById("wallet-address").value;
            var amountVal = document.getElementById("withdraw-amount").value;
            var msg = document.getElementById("msg-area");

            // Basit Kilit (Çift tıklama önleme)
            if(btn.disabled) return;
            btn.disabled = true;
            btn.innerText = "İşleniyor...";

            setTimeout(function() {
                processTransaction(address, amountVal, msg);
                btn.disabled = false;
                btn.innerText = "ONAYLA VE ÇEK";
            }, 800);
        }

        function processTransaction(address, amountVal, msg) {
            var amount = parseFloat(amountVal);
            var balance = parseFloat(localStorage.getItem("userMiningBalance")) || 0;
            var LIMIT = 30.0;
            
            if(!address) { msg.innerHTML = "<span style='color:orange'>Adres boş olamaz.</span>"; return; }
            if(!amount || amount <= 0) { msg.innerHTML = "<span style='color:orange'>Geçersiz tutar.</span>"; return; }

            var now = new Date();
            var record = {
                date: now.getHours() + ":" + (now.getMinutes()<10?'0':'') + now.getMinutes(),
                amount: amount.toFixed(4),
                status: "",
                note: ""
            };

            if (amount > balance) {
                record.status = "rejected"; record.note = "Yetersiz Bakiye";
                msg.innerHTML = "<span style='color:#ff4757'>Bakiye yetersiz!</span>";
            } else if (amount < LIMIT) {
                record.status = "rejected"; record.note = "Min: " + LIMIT;
                msg.innerHTML = "<span style='color:#ff4757'>Limit altı işlem.</span>";
            } else {
                record.status = "waiting"; record.note = "İşleniyor...";
                msg.innerHTML = "<span style='color:#00ff88'>Talep alındı.</span>";
            }

            saveHistory(record);
        }

        function saveHistory(record) {
            var history = JSON.parse(localStorage.getItem("withdrawHistory")) || [];
            if(history.length > 20) history.pop();
            history.unshift(record);
            localStorage.setItem("withdrawHistory", JSON.stringify(history));
            loadHistory();
        }

        function loadHistory() {
            var history = JSON.parse(localStorage.getItem("withdrawHistory")) || [];
            var tbody = document.getElementById("history-body");
            tbody.innerHTML = "";

            if (history.length === 0) {
                tbody.innerHTML = "<tr><td colspan='4' style='text-align:center; color:#555;'>İşlem yok.</td></tr>";
                return;
            }

            history.forEach(function(item) {
                var color = item.status === "waiting" ? "st-wait" : (item.status === "rejected" ? "st-rej" : "st-ok");
                var text = item.status === "waiting" ? "Beklemede" : (item.status === "rejected" ? "Red" : "Tamam");
                
                var row = `<tr>
                    <td>${item.date}</td>
                    <td>${item.amount}</td>
                    <td class="${color}">${text}</td>
                    <td style="color:#888; font-size:0.8rem;">${item.note}</td>
                </tr>`;
                tbody.innerHTML += row;
            });
        }
    </script>
</body>
</html>